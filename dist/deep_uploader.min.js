/*! deep_uploader 2015-09-28 */

!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){var b=l[a];if(b)return b;throw"Profile '"+a+"' not registered."}function f(a,b,c){var d=m[b.uploader];if(!d)throw"Unsupported uploader '"+b.uploader+"'.";return new d(a,b,c)}var g=a("./profile"),h=(d(g),a("./file_trigger")),i=d(h),j=a("./uploaders/qiniu_uploader"),k=d(j),l=[],m={qiniu:k["default"]},n={};n.register=function(a){l[a.name]=a},n.browse=function(a,b){var c=a.dataset.uploaderProfile||b,d=e(c);i["default"].trigger(a,d,function(b){var c=f(a,d,b);c.start()})},n.browseHandler=function(){n.browse(this)},window.DeepUploader=n},{"./file_trigger":3,"./profile":4,"./uploaders/qiniu_uploader":6}],2:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={};d.trigger=function(a,b){var c=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];a.dispatchEvent(new CustomEvent(b,{bubbles:!0,detail:c}))},c["default"]=d,b.exports=c["default"]},{}],3:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){var c=document.createElement("input");return c.setAttribute("type","file"),b.accept&&c.setAttribute("accept",b.accept),c.style.visibility="hidden",c.style.position="absolute",c.style.width="1px",c.style.height="1px",document.body.appendChild(c),c}Object.defineProperty(c,"__esModule",{value:!0});var f=a("./event_trigger"),g=d(f),h={};h.trigger=function(a,b,c){var d=e(a,b);d.addEventListener("change",function(e){for(var f=e.target.files,h=0;h<f.length;h++)c(f[h]),g["default"].trigger(a,"FileAdded",{element:a,profile:b,file:f[h]});d.parentNode.removeChild(d)},!1),d.click()},c["default"]=h,b.exports=c["default"]},{"./event_trigger":2}],4:[function(a,b,c){"use strict"},{}],5:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("../event_trigger"),h=d(g),i=function(){function a(b,c,d){e(this,a),this.element=b,this.profile=c,this.file=d}return f(a,[{key:"_detail",value:function(){return{element:this.element,profile:this.profile,file:this.file,xhr:this.xhr}}},{key:"start",value:function(){var a=this;a.xhr=new XMLHttpRequest,a.xhr.open("POST",a.profile.uploadUrl,!0),this.onBeforeUpload(function(){h["default"].trigger(a.element,"BeforeUpload",a._detail()),a.upload(function(){h["default"].trigger(a.element,"FileUpload",a._detail())})})}},{key:"onBeforeUpload",value:function(a){this.formData=new FormData,this.formData.append("file",this.file),this.formData.append("name",this.file.name),this.formData.append("key",this.file.name),a()}},{key:"upload",value:function(a){var b=this;b.xhr.onload=function(){if(200===b.xhr.status){var a=JSON.parse(b.xhr.responseText);b.onFileUploaded(a,function(){var a=b._detail();a.response=b.response,h["default"].trigger(b.element,"FileUploaded",a)})}else b.onFileError(b.xhr.status,b.xhr.responseText)},b.xhr.send(b.formData),a()}},{key:"cancel",value:function(){}},{key:"onFileProgress",value:function(){}},{key:"onFileUploaded",value:function(a,b){this.response=a,b()}},{key:"onFileError",value:function(a,b){var c=this._detail();c.responseStatus=a,c.responseText=b,h["default"].trigger(this.element,"FileError",c)}}]),a}();c["default"]=i,b.exports=c["default"]},{"../event_trigger":2}],6:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}},i=a("./base_uploader"),j=d(i),k=function(a){function b(a,c,d){e(this,b),h(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,a,c,d),this.profile.uploadUrl||(this.profile.uploadUrl="http://upload.qiniu.com/")}return f(b,a),g(b,[{key:"_fetchUploadToken",value:function(a){var b=this,c=new XMLHttpRequest;c.open("GET",this.profile.uptokenUrl,!0),c.onload=function(){if(200===c.status){var d=JSON.parse(c.responseText);b.formData.append("token",d.uptoken),a()}},c.send()}},{key:"onBeforeUpload",value:function(a){self=this,h(Object.getPrototypeOf(b.prototype),"onBeforeUpload",this).call(this,function(){self._fetchUploadToken(a)})}},{key:"onFileUploaded",value:function(a,c){var d=this;h(Object.getPrototypeOf(b.prototype),"onFileUploaded",this).call(this,a,function(){var a=encodeURIComponent(d.response.key);d.response.url=d.profile.domain+a,c()})}}]),b}(j["default"]);c["default"]=k,b.exports=c["default"]},{"./base_uploader":5}]},{},[1]);
//# sourceMappingURL=deep_uploader.min.js.map