/*! deep-uploader 2015-10-20 */

!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(a){var c;if(a.crypto&&crypto.getRandomValues){var d=new Uint8Array(16);c=function(){return crypto.getRandomValues(d),d}}if(!c){var e=new Array(16);c=function(){for(var a,b=0;16>b;b++)0===(3&b)&&(a=4294967296*Math.random()),e[b]=a>>>((3&b)<<3)&255;return e}}b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(a,b,c){function d(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){16>e&&(b[d+e++]=j[a])});16>e;)b[d+e++]=0;return b}function e(a,b){var c=b||0,d=i;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function f(a,b,c){var d=b&&c||0,f=b||[];a=a||{};var g=void 0!==a.clockseq?a.clockseq:n,h=void 0!==a.msecs?a.msecs:(new Date).getTime(),i=void 0!==a.nsecs?a.nsecs:p+1,j=h-o+(i-p)/1e4;if(0>j&&void 0===a.clockseq&&(g=g+1&16383),(0>j||h>o)&&void 0===a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");o=h,p=i,n=g,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;f[d++]=k>>>24&255,f[d++]=k>>>16&255,f[d++]=k>>>8&255,f[d++]=255&k;var l=h/4294967296*1e4&268435455;f[d++]=l>>>8&255,f[d++]=255&l,f[d++]=l>>>24&15|16,f[d++]=l>>>16&255,f[d++]=g>>>8|128,f[d++]=255&g;for(var q=a.node||m,r=0;6>r;r++)f[d+r]=q[r];return b?b:e(f)}function g(a,b,c){var d=b&&c||0;"string"==typeof a&&(b="binary"==a?new Array(16):null,a=null),a=a||{};var f=a.random||(a.rng||h)();if(f[6]=15&f[6]|64,f[8]=63&f[8]|128,b)for(var g=0;16>g;g++)b[d+g]=f[g];return b||e(f)}for(var h=a("./rng"),i=[],j={},k=0;256>k;k++)i[k]=(k+256).toString(16).substr(1),j[i[k]]=k;var l=h(),m=[1|l[0],l[1],l[2],l[3],l[4],l[5]],n=16383&(l[6]<<8|l[7]),o=0,p=0,q=g;q.v1=f,q.v4=g,q.parse=d,q.unparse=e,b.exports=q},{"./rng":1}],3:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){var b=k[a];if(b)return b;throw"Profile '"+a+"' not registered."}function f(a,b,c){var d=l[b.uploader];if(!d)throw"Unsupported uploader '"+b.uploader+"'.";return new d(a,b,c)}var g=a("./file-trigger"),h=d(g),i=a("./uploaders/qiniu-uploader"),j=d(i),k=[],l={qiniu:j["default"]},m={};m.register=function(a){k[a.name]=a},m.browse=function(a,b){var c=a.dataset.uploaderProfile||b,d=e(c);h["default"].trigger(a,d,function(b){var c=f(a,d,b);c.start()})},m.browseHandler=function(){m.browse(this)},window.DeepUploader=m},{"./file-trigger":5,"./uploaders/qiniu-uploader":7}],4:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={};d.trigger=function(a,b){var c=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];a.dispatchEvent(new CustomEvent(b,{bubbles:!0,detail:c}))},c["default"]=d,b.exports=c["default"]},{}],5:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){var c=document.createElement("input");return c.setAttribute("type","file"),b.accept&&c.setAttribute("accept",b.accept),c.style.visibility="hidden",c.style.position="absolute",c.style.width="1px",c.style.height="1px",document.body.appendChild(c),c}Object.defineProperty(c,"__esModule",{value:!0});var f=a("./event-trigger"),g=(d(f),{});g.trigger=function(a,b,c){var d=e(a,b);d.addEventListener("change",function(a){for(var b=a.target.files,e=0;e<b.length;e++)c(b[e]);d.parentNode.removeChild(d)},!1),d.click()},c["default"]=g,b.exports=c["default"]},{"./event-trigger":4}],6:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("../event-trigger"),h=d(g),i=a("uuid"),j=d(i),k=function(){function a(b,c,d){e(this,a),this.id=j["default"].v4(),this.element=b,this.profile=c,this.file=d,h["default"].trigger(this.element,"FileAdded",this._detail())}return f(a,[{key:"_detail",value:function(){return{id:this.id,element:this.element,profile:this.profile,file:this.file,xhr:this.xhr}}},{key:"filename",value:function(){var a=new Date,b=a.getFullYear(),c=a.getMonth()+1;c=c>9?c:"0"+c;var d=this.file.name.split(".").pop()||"tmp";return b+"/"+c+"/"+this.id+"."+d}},{key:"start",value:function(){var a=this;a.xhr=new XMLHttpRequest,a.xhr.open("POST",a.profile.uploadUrl,!0),this.onBeforeUpload(function(){h["default"].trigger(a.element,"BeforeUpload",a._detail()),a.upload(function(){h["default"].trigger(a.element,"FileUpload",a._detail())})})}},{key:"onBeforeUpload",value:function(a){var b=this.filename();this.formData=new FormData,this.formData.append("file",this.file),this.formData.append("key",b),a()}},{key:"upload",value:function(a){var b=this;b.xhr.onload=function(){if(200===b.xhr.status){var a=JSON.parse(b.xhr.responseText);b.onFileUploaded(a,function(){var a=b._detail();a.response=b.response,h["default"].trigger(b.element,"FileUploaded",a)})}else b.onFileError(b.xhr.status,b.xhr.responseText)},b.xhr.upload.onprogress=function(a){if(a.lengthComputable){var c=a.loaded/a.total;b.onFileProgress(function(){var a=b._detail();a.percent=c,h["default"].trigger(b.element,"FileProgress",a)})}},b.xhr.send(b.formData),a()}},{key:"cancel",value:function(){}},{key:"onFileProgress",value:function(a){a()}},{key:"onFileUploaded",value:function(a,b){this.response=a,b()}},{key:"onFileError",value:function(a,b){var c=this._detail();c.responseStatus=a,c.responseText=b,h["default"].trigger(this.element,"FileError",c)}}]),a}();c["default"]=k,b.exports=c["default"]},{"../event-trigger":4,uuid:2}],7:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}},i=a("./base-uploader"),j=d(i),k=function(a){function b(a,c,d){e(this,b),h(Object.getPrototypeOf(b.prototype),"constructor",this).call(this,a,c,d),this.profile.uploadUrl||(this.profile.uploadUrl="http://upload.qiniu.com/")}return f(b,a),g(b,[{key:"_fetchUploadToken",value:function(a){var b=this,c=new XMLHttpRequest;c.open("GET",this.profile.uptokenUrl,!0),c.onload=function(){if(200===c.status){var d=JSON.parse(c.responseText);b.formData.append("token",d.uptoken),a()}},c.send()}},{key:"onBeforeUpload",value:function(a){self=this,h(Object.getPrototypeOf(b.prototype),"onBeforeUpload",this).call(this,function(){self._fetchUploadToken(a)})}},{key:"onFileUploaded",value:function(a,c){var d=this;h(Object.getPrototypeOf(b.prototype),"onFileUploaded",this).call(this,a,function(){d.response.url=d.profile.domain+d.response.key,c()})}}]),b}(j["default"]);c["default"]=k,b.exports=c["default"]},{"./base-uploader":6}]},{},[3]);
//# sourceMappingURL=deep-uploader.min.js.map